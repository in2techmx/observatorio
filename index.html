<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROXIMITY | Neural Tactical Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        /* [Insertar aquí el CSS de la v35.6] */
        :root {
            --bg-color: #050507;
            --panel-color: #0a0a0f;
            --border-color: #1a1a2e;
            --text-primary: #e0e0e0;
            --text-dim: #707080;
            --consensus-color: #00ff88;
            --divergent-color: #ffaa00;
            --anomaly-color: #ff00ff;
            --accent-cyan: #00fffb;
        }
        body { background-color: var(--bg-color); color: var(--text-primary); font-family: 'Rajdhani', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; }
        header { width: 100%; padding: 30px 20px; background: linear-gradient(to bottom, #000, transparent); text-align: center; border-bottom: 1px solid var(--border-color); }
        .glitch-title { font-family: 'Share Tech Mono', monospace; font-size: 2.8rem; letter-spacing: 8px; color: #fff; text-shadow: 3px 0 #ff004c, -3px 0 var(--accent-cyan); margin: 0 0 25px 0; text-transform: uppercase; }
        .dashboard { display: flex; justify-content: center; gap: 15px; margin: 25px auto; width: 95%; max-width: 1100px; }
        .stat-card { background: var(--panel-color); border: 1px solid var(--border-color); padding: 12px 20px; flex: 1; text-align: center; border-left: 3px solid var(--accent-cyan); }
        .stat-card .value { font-size: 1.6rem; font-family: 'Share Tech Mono', monospace; color: var(--accent-cyan); display: block; }
        .controls-container { display: flex; flex-direction: column; gap: 15px; margin: 20px 0; align-items: center; }
        .time-controls, .filter-controls { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .btn { background: var(--panel-color); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 18px; font-family: 'Share Tech Mono', monospace; cursor: pointer; }
        .btn.active { border-color: var(--accent-cyan); color: var(--accent-cyan); }
        .filter-select { background: var(--panel-color); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 15px; font-family: 'Rajdhani', sans-serif; }
        #radar-container { position: relative; width: 95%; max-width: 1000px; margin: 20px auto; aspect-ratio: 10 / 7; background: radial-gradient(circle, #0f0f1a 0%, #050507 80%); border: 1px solid var(--border-color); }
        svg { width: 100%; height: 100%; display: block; }
        .radar-ring { fill: none; stroke: rgba(255, 255, 255, 0.05); }
        .node { cursor: pointer; transition: 0.4s; }
        #tooltip { position: absolute; padding: 15px; background: rgba(5, 5, 10, 0.95); border: 1px solid var(--accent-cyan); color: #fff; display: none; z-index: 1000; max-width: 280px; }
        .methodology { max-width: 900px; padding: 50px; background: var(--panel-color); border-top: 1px solid var(--border-color); margin: 60px 0; }
        .loading-overlay { position: absolute; inset: 0; background: var(--bg-color); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .spinner { width: 40px; height: 40px; border: 3px solid rgba(0, 255, 251, 0.1); border-top: 3px solid var(--accent-cyan); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<header>
    <h1 class="glitch-title">Neural Tactical Hub</h1>
    
    <div class="controls-container">
        <div class="time-controls">
            <button class="btn active" data-type="daily">DIARIO (HOY)</button>
            
            <select id="week-selector" class="filter-select btn">
                <option value="">SELECCIONAR SEMANA</option>
                <option value="s1">Semana 1 (mes_s1.json)</option>
                <option value="s2">Semana 2 (mes_s2.json)</option>
                <option value="s3">Semana 3 (mes_s3.json)</option>
                <option value="s4">Semana 4 (mes_s4.json)</option>
            </select>

            <select id="month-selector" class="filter-select btn">
                <option value="">SELECCIONAR MES</option>
                <option value="ene">Enero (mes_ene.json)</option>
                <option value="feb">Febrero (mes_feb.json)</option>
                <option value="mar">Marzo (mes_mar.json)</option>
            </select>
        </div>

        <div class="filter-controls">
            <select id="block-filter" class="filter-select">
                <option value="ALL">BLOQUES: TODOS</option>
                <option value="USA">USA</option>
                <option value="RUSSIA">RUSSIA</option>
                <option value="CHINA">CHINA</option>
                <option value="EUROPE">EUROPE</option>
                <option value="GLOBAL">GLOBAL</option>
            </select>
        </div>
    </div>

    <div class="dashboard">
        <div class="stat-card"><span class="label">Nodos Activos</span><span id="stat-nodes" class="value">---</span></div>
        <div class="stat-card"><span class="label">Consenso</span><span id="stat-prox" class="value">--%</span></div>
        <div class="stat-card"><span class="label">Dataset</span><span id="stat-file" class="value">---</span></div>
    </div>
</header>

<div id="radar-container">
    <div id="loading" class="loading-overlay"><div class="spinner"></div></div>
    <div id="tooltip"></div>
    <svg id="radarSVG" viewBox="0 0 1000 700">
        <circle cx="500" cy="350" r="100" class="radar-ring" />
        <circle cx="500" cy="350" r="200" class="radar-ring" />
        <circle cx="500" cy="350" r="300" class="radar-ring" />
        <g id="node-layer"></g>
    </svg>
</div>

<section class="methodology">
    <h2>MÉTODO: AGREGACIÓN MULTI-CAPA</h2>
    <p>La inteligencia geopolítica requiere distinguir entre el <strong>ruido diario</strong> y la <strong>tendencia estructural</strong>.</p>
    
    <h3>Lógica de Procesamiento</h3>
    <ul>
        <li><strong>Nivel 1 (Diario):</strong> Escaneo de 45+ fuentes para detectar señales inmediatas.</li>
        <li><strong>Nivel 2 (Semanal - mes_sX):</strong> Consolidación de 7 días de datos para filtrar noticias efímeras y resaltar temas persistentes.</li>
        <li><strong>Nivel 3 (Mensual - mes_XXX):</strong> Fusión de las 4 semanas para identificar cambios en las alianzas globales y el centro de gravedad del poder.</li>
    </ul>
</section>

<script>
    const state = {
        data: null,
        filters: { block: 'ALL', area: 'ALL' },
        currentFile: 'gravity_carousel.json'
    };

    async function loadRadar(filename) {
        document.getElementById('loading').style.display = 'flex';
        state.currentFile = filename;
        try {
            const res = await fetch(filename);
            if(!res.ok) throw new Error("Archivo no encontrado");
            state.data = await res.json();
            render();
        } catch (err) {
            console.error(err);
            alert(`Error: No se encontró el archivo ${filename}`);
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    }

    function render() {
        const layer = document.getElementById('node-layer');
        layer.innerHTML = '';
        let total = 0, sumProx = 0;

        state.data.carousel.forEach(area => {
            area.particulas.forEach(p => {
                if (state.filters.block !== 'ALL' && p.bloque !== state.filters.block) return;

                total++; sumProx += p.proximidad;
                const r = 320 - (p.proximidad * 2.8);
                const angle = Math.random() * Math.PI * 2;
                const x = 500 + r * Math.cos(angle);
                const y = 350 + r * Math.sin(angle);

                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", x); circle.setAttribute("cy", y);
                circle.setAttribute("r", p.proximidad > 85 ? 6 : 4);
                circle.setAttribute("fill", area.color);
                circle.setAttribute("class", "node");
                circle.style.setProperty('--glow', area.color);
                
                circle.onmouseover = (e) => showTooltip(e, p, area);
                circle.onmouseout = () => document.getElementById('tooltip').style.display = 'none';
                circle.onclick = () => window.open(p.link, '_blank');

                layer.appendChild(circle);
            });
        });

        document.getElementById('stat-nodes').innerText = total;
        document.getElementById('stat-prox').innerText = `${Math.round(sumProx/total)}%`;
        document.getElementById('stat-file').innerText = state.currentFile.toUpperCase();
    }

    function showTooltip(e, p, area) {
        const tt = document.getElementById('tooltip');
        tt.style.display = 'block';
        tt.style.left = (e.pageX + 15) + 'px';
        tt.style.top = (e.pageY + 15) + 'px';
        tt.innerHTML = `<strong>${p.bloque}</strong><br>${p.titulo}<br>Consenso: ${p.proximidad}%`;
    }

    // EVENTOS DE SELECTORES
    document.querySelector('[data-type="daily"]').onclick = () => loadRadar('gravity_carousel.json');

    document.getElementById('week-selector').onchange = (e) => {
        if(e.target.value) loadRadar(`mes_${e.target.value}.json`);
    };

    document.getElementById('month-selector').onchange = (e) => {
        if(e.target.value) loadRadar(`mes_${e.target.value}.json`);
    };

    document.getElementById('block-filter').onchange = (e) => {
        state.filters.block = e.target.value;
        render();
    };

    window.onload = () => loadRadar('gravity_carousel.json');
</script>

</body>
</html>
