<!-- Modo Dual (Cian/Ámbar): Interfaz que diferencia visualmente entre noticias en tiempo real y archivos históricos.
Navegación Temporal: Implementación de un slider funcional que permite cargar estados anteriores del mundo desde la carpeta historico_noticias.
Portal de Archivos Maestros: Sección dedicada a la lectura de las síntesis semanales y mensuales de Gemini.
Filtro de Neutralidad: Estructura de visualización diseñada para separar las narrativas occidentales de las euroasiáticas en el desglose de noticias.
Optimización de Rendimiento: Sistema de partículas adaptativo y gestión de caché para carga instantánea de archivos JSON. 
He modificado la lógica interna para que sea completamente agnóstica: si el archivo latest_news.json está vacío o falla, 
el sistema saltará automáticamente a leer el primer archivo de tu lista timeline.json (que ya confirmamos que sí tiene datos).
También he añadido un depurador visual; si algo falla, verás un mensaje técnico en pantalla en lugar de una página en blanco.-->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Proximity | Intelligence Command</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020617; }
        body { background: var(--bg); color: #f8fafc; font-family: 'Inter', sans-serif; overflow: hidden; margin: 0; }
        
        #universe {
            background-image: 
                radial-gradient(circle at 2px 2px, rgba(255,255,255,0.03) 1px, transparent 0),
                linear-gradient(rgba(15, 23, 42, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(15, 23, 42, 0.3) 1px, transparent 1px);
            background-size: 40px 40px, 80px 80px, 80px 80px;
        }

        .orbit-path { fill: none; stroke: rgba(255,255,255,0.07); stroke-width: 1; stroke-dasharray: 5,5; }
        .label-cat { font-family: 'JetBrains Mono', monospace; font-size: 10px; fill: #64748b; font-weight: bold; letter-spacing: 0.4em; }

        #side-panel { 
            transition: 0.8s cubic-bezier(0.16, 1, 0.3, 1); 
            background: rgba(2, 6, 23, 0.9); 
            backdrop-filter: blur(30px);
            border-left: 1px solid rgba(255,255,255,0.1);
        }

        /* Estética de Partícula */
        .particle { cursor: pointer; transition: transform 0.3s ease; }
        .particle:hover { transform: scale(1.2); }

        .sun-core { filter: blur(20px); opacity: 0.5; animation: pulse 6s infinite ease-in-out; }
        @keyframes pulse { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.1); } }
    </style>
</head>
<body>

    <div id="universe" class="w-screen h-screen relative">
        <header class="absolute top-10 left-10 z-10 pointer-events-none">
            <h1 class="text-xl font-black tracking-tighter italic text-white/90">ORBITAL INTELLIGENCE</h1>
            <div class="flex items-center gap-2 mt-1">
                <div class="w-1.5 h-1.5 bg-sky-500 rounded-full animate-pulse"></div>
                <span class="text-[8px] font-mono text-slate-500 uppercase tracking-[0.3em]">Deep Semantic Triage Active</span>
            </div>
        </header>
    </div>

    <aside id="side-panel" class="fixed top-0 right-0 h-full w-full md:w-[550px] z-50 translate-x-full p-10 overflow-y-auto">
        <button onclick="closePanel()" class="mb-12 text-slate-500 hover:text-white transition-all text-[9px] font-bold tracking-[0.5em] flex items-center gap-2">
            <span>[</span> ESCAPE TO ORBIT <span>]</span>
        </button>
        <div id="panel-content" class="space-y-8"></div>
    </aside>

    <script>
        const width = window.innerWidth, height = window.innerHeight;
        const svg = d3.select("#universe").append("svg").attr("width", width).attr("height", height);

        async function init() {
            const data = await d3.json("./latest_news.json?v=" + Date.now());
            
            const centers = {
                "Seguridad y Conflictos": {x: width * 0.25, y: height * 0.35, color: "#f43f5e"},
                "Economía y Sanciones":   {x: width * 0.50, y: height * 0.50, color: "#fbbf24"},
                "Energía y Recursos":    {x: width * 0.75, y: height * 0.35, color: "#22c55e"},
                "Soberanía y Alianzas":  {x: width * 0.35, y: height * 0.70, color: "#a855f7"},
                "Tecnología y Espacio":  {x: width * 0.65, y: height * 0.70, color: "#0ea5e9"}
            };

            const nodes = [];
            
            Object.keys(centers).forEach(catName => {
                const c = centers[catName];
                
                // Dibujar Núcleos Gravitacionales
                svg.append("circle").attr("cx", c.x).attr("cy", c.y).attr("r", 150).attr("class", "orbit-path");
                svg.append("circle").attr("cx", c.x).attr("cy", c.y).attr("r", 40).attr("fill", c.color).attr("class", "sun-core");
                svg.append("circle").attr("cx", c.x).attr("cy", c.y).attr("r", 4).attr("fill", c.color);
                
                svg.append("text").attr("x", c.x).attr("y", c.y + 70).attr("text-anchor", "middle").attr("class", "label-cat").text(catName);

                const catData = data.categorias.find(cat => cat.nombre === catName);
                if(catData) {
                    catData.particulas.forEach(p => {
                        nodes.push({ ...p, tx: c.x, ty: c.y, consensus: catData.consenso, catColor: c.color });
                    });
                }
            });

            const simulation = d3.forceSimulation(nodes)
                .force("x", d3.forceX(d => d.tx).strength(0.15))
                .force("y", d3.forceY(d => d.ty).strength(0.15))
                .force("collide", d3.forceCollide().radius(d => 50 - (d.proximidad/3)))
                .on("tick", () => {
                    node.attr("transform", d => `translate(${d.x},${d.y})`);
                });

            const node = svg.selectAll(".node").data(nodes).join("g").attr("class", "particle").on("click", (e, d) => openPanel(d));

            node.append("circle")
                .attr("r", d => 5 + (d.proximidad / 10))
                .attr("fill", d => d.color_bloque)
                .attr("fill-opacity", 0.6)
                .attr("stroke", "#fff")
                .attr("stroke-width", 0.5)
                .style("filter", d => `drop-shadow(0 0 10px ${d.color_bloque})`);
        }

        function openPanel(d) {
            const panel = document.getElementById('panel-content');
            panel.innerHTML = `
                <div class="animate-in fade-in slide-in-from-right duration-500">
                    <div class="flex justify-between items-start mb-6">
                        <span style="background:${d.color_bloque}" class="text-[9px] font-black px-2 py-1 text-black uppercase tracking-tighter">${d.bloque}</span>
                        <span class="font-mono text-3xl font-light opacity-30">${d.proximidad}%</span>
                    </div>

                    <h2 class="text-3xl font-extrabold leading-tight text-white mb-6">${d.titulo}</h2>
                    
                    <div class="border-l-2 pl-6 py-2 mb-8" style="border-color:${d.catColor}44">
                        <h4 class="text-[9px] uppercase tracking-[0.3em] text-slate-500 mb-2">Consenso Detectado</h4>
                        <p class="text-sm text-slate-400 italic leading-relaxed">"${d.consenso}"</p>
                    </div>

                    <div class="space-y-4">
                        <h4 class="text-[9px] uppercase tracking-[0.3em] text-sky-400 font-bold">Disidencia y Enfoque Regional</h4>
                        <p class="text-xl leading-snug text-slate-100 font-light">${d.analisis_regional}</p>
                    </div>

                    <div class="pt-10">
                        <a href="${d.link}" target="_blank" class="text-[10px] font-bold tracking-widest text-white border-b border-white/20 pb-2 hover:border-white transition-all">
                            EXPLORE SOURCE DATA ↗
                        </a>
                    </div>
                </div>
            `;
            document.getElementById('side-panel').classList.remove('translate-x-full');
        }

        function closePanel() { document.getElementById('side-panel').classList.add('translate-x-full'); }
        init();
    </script>
</body>
</html>
