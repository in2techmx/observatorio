<!-- Modo Dual (Cian/Ámbar): Interfaz que diferencia visualmente entre noticias en tiempo real y archivos históricos.
Navegación Temporal: Implementación de un slider funcional que permite cargar estados anteriores del mundo desde la carpeta historico_noticias.
Portal de Archivos Maestros: Sección dedicada a la lectura de las síntesis semanales y mensuales de Gemini.
Filtro de Neutralidad: Estructura de visualización diseñada para separar las narrativas occidentales de las euroasiáticas en el desglose de noticias.
Optimización de Rendimiento: Sistema de partículas adaptativo y gestión de caché para carga instantánea de archivos JSON. 
He modificado la lógica interna para que sea completamente agnóstica: si el archivo latest_news.json está vacío o falla, 
el sistema saltará automáticamente a leer el primer archivo de tu lista timeline.json (que ya confirmamos que sí tiene datos).
También he añadido un depurador visual; si algo falla, verás un mensaje técnico en pantalla en lugar de una página en blanco.-->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Proximity | Orbit Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020617; }
        body { 
            background: var(--bg); 
            color: #f8fafc; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; margin: 0;
        }
        
        /* Fondo de Estrellas y Rejilla */
        #universe {
            background-image: 
                radial-gradient(circle at 2px 2px, rgba(255,255,255,0.05) 1px, transparent 0),
                linear-gradient(rgba(15, 23, 42, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(15, 23, 42, 0.5) 1px, transparent 1px);
            background-size: 50px 50px, 100px 100px, 100px 100px;
        }

        .category-node { filter: drop-shadow(0 0 20px currentColor); }
        .orbit-path { fill: none; stroke: rgba(255,255,255,0.05); stroke-width: 1; stroke-dasharray: 4; }
        
        .label-cat { 
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px; fill: #94a3b8; font-weight: bold;
            text-transform: uppercase; letter-spacing: 0.3em;
        }

        #side-panel { 
            transition: 0.7s cubic-bezier(0.19, 1, 0.22, 1); 
            background: rgba(2, 6, 23, 0.85); 
            backdrop-filter: blur(25px);
            border-left: 1px solid rgba(255,255,255,0.1);
        }

        .proximity-bar { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; }
        .proximity-fill { height: 100%; transition: width 1s ease-out; }

        /* Animación de pulso para los núcleos */
        @keyframes pulse {
            0% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.6; transform: scale(1); }
        }
        .sun-core { animation: pulse 4s infinite ease-in-out; }
    </style>
</head>
<body>

    <div id="universe" class="w-screen h-screen relative">
        <div class="absolute top-10 left-10 z-10 pointer-events-none">
            <h1 class="text-2xl font-black tracking-tighter italic text-white">GLOBAL PROXIMITY</h1>
            <div class="flex items-center gap-2 mt-1">
                <span class="w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
                <span class="text-[9px] font-mono text-slate-400 uppercase tracking-widest">Live Strategic Deep Scan</span>
            </div>
        </div>
    </div>

    <aside id="side-panel" class="fixed top-0 right-0 h-full w-full md:w-[500px] z-50 translate-x-full p-12 overflow-y-auto">
        <button onclick="closePanel()" class="mb-12 group flex items-center gap-3 text-slate-500 hover:text-white transition-all text-[10px] font-bold tracking-widest">
            <span class="transform group-hover:-translate-x-1 transition-transform">←</span> REGRESAR AL ESPACIO
        </button>
        <div id="panel-content"></div>
    </aside>

    <script>
        const width = window.innerWidth, height = window.innerHeight;
        const svg = d3.select("#universe").append("svg")
            .attr("width", width).attr("height", height);

        async function init() {
            const data = await d3.json("./latest_news.json?v=" + Date.now());
            
            const centers = {
                "Seguridad y Conflictos": {x: width * 0.25, y: height * 0.30, color: "#f43f5e"},
                "Economía y Sanciones":   {x: width * 0.50, y: height * 0.50, color: "#fbbf24"},
                "Energía y Recursos":    {x: width * 0.75, y: height * 0.30, color: "#22c55e"},
                "Soberanía y Alianzas":  {x: width * 0.30, y: height * 0.75, color: "#a855f7"},
                "Tecnología y Espacio":  {x: width * 0.70, y: height * 0.75, color: "#0ea5e9"}
            };

            const nodes = [];
            
            // Dibujar Soles y Órbitas
            Object.keys(centers).forEach(catName => {
                const c = centers[catName];
                
                // Órbita visual
                svg.append("circle")
                    .attr("cx", c.x).attr("cy", c.y).attr("r", 140)
                    .attr("class", "orbit-path");

                // Núcleo del Sol (Categoría)
                const sun = svg.append("g").attr("transform", `translate(${c.x}, ${c.y})`);
                
                sun.append("circle")
                    .attr("r", 25)
                    .attr("fill", c.color)
                    .attr("class", "sun-core")
                    .style("filter", `blur(15px)`);

                sun.append("circle")
                    .attr("r", 15)
                    .attr("fill", c.color);

                svg.append("text")
                    .attr("x", c.x).attr("y", c.y + 60)
                    .attr("text-anchor", "middle").attr("class", "label-cat")
                    .text(catName);

                // Filtrar partículas de esta categoría
                const catData = data.categorias.find(cat => cat.nombre === catName);
                if(catData) {
                    catData.particulas.forEach(p => {
                        nodes.push({ ...p, tx: c.x, ty: c.y, consensus: catData.consenso });
                    });
                }
            });

            const simulation = d3.forceSimulation(nodes)
                .force("x", d3.forceX(d => d.tx).strength(0.1))
                .force("y", d3.forceY(d => d.ty).strength(0.1))
                .force("collide", d3.forceCollide().radius(d => 45 - (d.proximidad/4)))
                .on("tick", () => {
                    node.attr("transform", d => `translate(${d.x},${d.y})`);
                });

            const node = svg.selectAll(".node").data(nodes).join("g")
                .attr("class", "cursor-pointer")
                .on("click", (e, d) => openPanel(d));

            // Partícula de Noticia
            node.append("circle")
                .attr("r", d => 4 + (d.proximidad / 12))
                .attr("fill", d => d.color_bloque)
                .attr("fill-opacity", d => 0.2 + (d.proximidad / 150))
                .attr("stroke", d => d.color_bloque)
                .attr("stroke-width", 1.5)
                .style("filter", d => `drop-shadow(0 0 ${d.proximidad/10}px ${d.color_bloque})`);
        }

        function openPanel(d) {
            const panel = document.getElementById('panel-content');
            panel.innerHTML = `
                <div class="space-y-8 animate-in slide-in-from-bottom duration-500">
                    <div class="flex justify-between items-end">
                        <div style="color:${d.color_bloque}" class="font-mono text-[10px] font-bold tracking-[0.3em] uppercase">
                            Origin: ${d.bloque}
                        </div>
                        <div class="text-5xl font-black italic opacity-20">${d.proximidad}%</div>
                    </div>

                    <h2 class="text-3xl font-bold leading-tight tracking-tight">${d.titulo}</h2>
                    
                    <div class="p-6 bg-white/5 border border-white/10 rounded-sm">
                        <div class="text-[9px] uppercase tracking-widest text-slate-500 mb-2">Consenso Global</div>
                        <p class="text-xs text-slate-400 italic leading-relaxed">"${d.consenso}"</p>
                    </div>

                    <div class="proximity-bar">
                        <div class="proximity-fill" style="width:${d.proximidad}%; background:${d.color_bloque}"></div>
                    </div>

                    <div>
                        <div class="text-[9px] uppercase tracking-widest text-sky-500 mb-3 font-bold">Análisis de Disidencia Regional</div>
                        <p class="text-lg leading-snug text-slate-200 font-light">${d.analisis_regional}</p>
                    </div>

                    <div class="pt-8">
                        <a href="${d.link}" target="_blank" class="inline-block border border-white/20 px-6 py-3 text-[10px] font-bold tracking-[0.2em] hover:bg-white hover:text-black transition-all">
                            VER FUENTE ORIGINAL ↗
                        </a>
                    </div>
                </div>
            `;
            document.getElementById('side-panel').classList.remove('translate-x-full');
        }

        function closePanel() { document.getElementById('side-panel').classList.add('translate-x-full'); }
        init();
    </script>
</body>
</html>
