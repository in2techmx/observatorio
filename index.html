#Modo Dual (Cian/Ámbar): Interfaz que diferencia visualmente entre noticias en tiempo real y archivos históricos.
#Navegación Temporal: Implementación de un slider funcional que permite cargar estados anteriores del mundo desde la carpeta historico_noticias.
#Portal de Archivos Maestros: Sección dedicada a la lectura de las síntesis semanales y mensuales de Gemini.
#Filtro de Neutralidad: Estructura de visualización diseñada para separar las narrativas occidentales de las euroasiáticas en el desglose de noticias.
#Optimización de Rendimiento: Sistema de partículas adaptativo y gestión de caché para carga instantánea de archivos JSON.

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global News Proximity | Observatorio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --usa: #3b82f6; --china: #ef4444; --russia: #b91c1c; --europe: #8b5cf6;
            --india: #f59e0b; --mideast: #10b981; --latam: #ec4899; --africa: #06b6d4; --uk: #6366f1;
        }
        body { margin: 0; background: #020202; color: white; overflow: hidden; font-family: 'Outfit', sans-serif; }
        #bg-canvas { position: fixed; top: 0; left: 0; z-index: -1; width: 100%; height: 100%; }
        .glass { background: rgba(15, 15, 25, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        .hide-scroll::-webkit-scrollbar { display: none; }
        input[type=range] { -webkit-appearance: none; background: rgba(255,255,255,0.1); height: 4px; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: currentColor; cursor: pointer; box-shadow: 0 0 10px currentColor; }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const REGIONS = {
            USA: { name: 'USA', color: 'var(--usa)' }, CHINA: { name: 'China', color: 'var(--china)' },
            RUSSIA: { name: 'Rusia', color: 'var(--russia)' }, EUROPE: { name: 'Europa', color: 'var(--europe)' },
            INDIA: { name: 'India', color: 'var(--india)' }, MID_EAST: { name: 'M. Oriente', color: 'var(--mideast)' },
            LATAM: { name: 'LATAM', color: 'var(--latam)' }, AFRICA: { name: 'África', color: 'var(--africa)' },
            UK: { name: 'Reino Unido', color: 'var(--uk)' }
        };

        function App() {
            const [data, setData] = useState([]);
            const [timeline, setTimeline] = useState([]);
            const [maestros, setMaestros] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [showHistory, setShowHistory] = useState(false);
            const [selected, setSelected] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const canvas = document.getElementById('bg-canvas');
                const ctx = canvas.getContext('2d');
                let pts = [];
                const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                resize(); window.onresize = resize;
                for(let i=0; i<70; i++) pts.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, s:Math.random()*2, vx:(Math.random()-0.5)*0.2, vy:(Math.random()-0.5)*0.2});
                
                const draw = () => {
                    ctx.clearRect(0,0,canvas.width,canvas.height);
                    ctx.fillStyle = showHistory ? "rgba(212, 175, 55, 0.4)" : "rgba(59, 130, 246, 0.4)";
                    pts.forEach(p => {
                        p.x+=p.vx; p.y+=p.vy;
                        if(p.x<0)p.x=canvas.width; if(p.y<0)p.y=canvas.height;
                        if(p.x>canvas.width)p.x=0; if(p.y>canvas.height)p.y=0;
                        ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2); ctx.fill();
                    });
                    requestAnimationFrame(draw);
                };
                const anim = requestAnimationFrame(draw);
                return () => cancelAnimationFrame(anim);
            }, [showHistory]);

            useEffect(() => {
                const init = async () => {
                    try {
                        const [resTime, resMaestros] = await Promise.all([
                            fetch(`./timeline.json?t=${Date.now()}`).then(r => r.json()).catch(() => []),
                            fetch(`./maestros_index.json?t=${Date.now()}`).then(r => r.json()).catch(() => [])
                        ]);
                        setTimeline(resTime);
                        setMaestros(resMaestros);
                        if(resTime.length > 0) loadFile(resTime[0]);
                        setLoading(false);
                    } catch(e) { console.error(e); setLoading(false); }
                };
                init();
            }, []);

            const loadFile = async (name) => {
                try {
                    const res = await fetch(`./historico_noticias/${name}`);
                    const json = await res.json();
                    setData(json);
                } catch (e) { console.error("Error loading file", name); }
            };

            const handleSlider = (i) => {
                setCurrentIndex(i);
                loadFile(timeline[i]);
                setSelected(null);
            };

            if(loading) return <div className="h-screen flex items-center justify-center tracking-[0.5em] text-[10px] opacity-40">CARGANDO ARCHIVOS DE INTELIGENCIA...</div>;

            return (
                <div className="h-screen w-full flex flex-col p-10 overflow-hidden relative">
                    <header className="mb-12 flex justify-between items-start z-10">
                        <motion.div animate={{ color: showHistory ? '#d4af37' : '#3b82f6' }}>
                            <h1 className="text-5xl font-black italic tracking-tighter uppercase">Global Proximity</h1>
                            <p className="text-[10px] tracking-[0.3em] uppercase opacity-40 mt-2 font-bold italic">Observatorio Geopolítico v2.4</p>
                        </motion.div>

                        <div className="flex gap-4">
                            <motion.button 
                                whileHover={{ scale: 1.05 }}
                                onClick={() => setShowHistory(!showHistory)}
                                className={`px-8 py-3 rounded-full border text-[10px] font-bold tracking-widest uppercase transition-all ${showHistory ? 'border-blue-500 text-blue-500 bg-blue-500/5' : 'border-amber-600 text-amber-500 bg-amber-500/5 shadow-[0_0_20px_rgba(212,175,55,0.1)]'}`}
                            >
                                {showHistory ? "← Regresar al Presente" : "Portal de Archivos Maestros"}
                            </motion.button>
                        </div>
                    </header>

                    <AnimatePresence mode="wait">
                        {!showHistory ? (
                            <motion.div key="present" initial={{opacity:0, y:20}} animate={{opacity:1, y:0}} exit={{opacity:0, y:-20}} className="flex-1 flex flex-col">
                                <div className="mb-10 flex items-center gap-6 glass p-4 rounded-full max-w-2xl mx-auto w-full text-blue-500">
                                    <span className="text-[9px] font-bold uppercase tracking-tighter opacity-50">Pasado</span>
                                    <input type="range" min="0" max={timeline.length-1} value={currentIndex} onChange={(e)=>handleSlider(parseInt(e.target.value))} className="flex-1" style={{direction:'rtl'}} />
                                    <span className="text-[9px] font-bold uppercase tracking-tighter">Presente</span>
                                    <div className="border-l border-white/10 pl-6 text-[10px] font-mono whitespace-nowrap">{data[0]?.timestamp || 'Actualizando...'}</div>
                                </div>

                                <div className="flex-1 flex items-center gap-8 overflow-x-auto pb-10 hide-scroll snap-x">
                                    {data.map((item, i) => (
                                        <motion.div key={i} whileHover={{y:-10}} onClick={() => setSelected(item)} className="min-w-[420px] glass p-10 rounded-[3rem] cursor-pointer snap-center border-b-2 border-blue-500/20 hover:border-blue-500/60 transition-all">
                                            <span className="text-blue-500 text-[9px] font-bold tracking-widest uppercase mb-4 block opacity-50 italic">Eje Narrativo {i+1}</span>
                                            <h2 className="text-2xl font-black mb-4 leading-tight uppercase italic tracking-tighter">{item.tematica}</h2>
                                            <p className="text-gray-400 text-xs leading-relaxed line-clamp-3 font-light italic">"{item.descripcion}"</p>
                                            <div className="mt-8 flex gap-2">
                                                {item.regiones_activas.map(r => <div key={r} className="w-2 h-2 rounded-full" style={{background: REGIONS[r]?.color}} />)}
                                            </div>
                                        </motion.div>
                                    ))}
                                </div>
                            </motion.div>
                        ) : (
                            <motion.div key="history" initial={{opacity:0, x:50}} animate={{opacity:1, x:0}} exit={{opacity:0, x:-50}} className="flex-1 flex flex-col justify-center">
                                <h2 className="text-amber-500/50 text-[10px] tracking-[0.5em] uppercase mb-10 text-center font-bold italic">SÍNTESIS DE MEMORIA GEOPOLÍTICA</h2>
                                <div className="flex gap-8 overflow-x-auto pb-10 hide-scroll snap-x">
                                    {maestros.length > 0 ? maestros.map((m, i) => (
                                        <div key={i} className="min-w-[480px] glass border-amber-500/10 p-12 rounded-[3.5rem] snap-center relative overflow-hidden group hover:border-amber-500/40 transition-all">
                                            <span className="text-amber-500 text-[9px] font-black tracking-[0.4em] uppercase">{m.includes('semanal') ? 'Semanario' : 'Anuario Mensual'}</span>
                                            <h3 className="text-3xl font-bold mt-4 mb-6 text-amber-50/80 uppercase italic tracking-tighter">{m.replace('.json', '').replace('_', ' ')}</h3>
                                            <p className="text-amber-200/20 text-xs italic leading-relaxed mb-8">Archivo de divergencia comprimido. Las colisiones narrativas regionales han sido preservadas.</p>
                                            <button className="text-amber-500 text-[10px] font-black uppercase tracking-widest border-b-2 border-amber-500/30 pb-1">Consultar Registro</button>
                                        </div>
                                    )) : (
                                        <div className="w-full text-center text-amber-500/20 italic tracking-widest uppercase text-xs p-20 border-2 border-dashed border-amber-500/10 rounded-[3rem]">Esperando primera consolidación semanal...</div>
                                    )}
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>

                    <AnimatePresence>
                        {selected && (
                            <motion.div initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} className="fixed inset-0 z-50 p-20 glass flex items-center justify-center bg-black/95 backdrop-blur-3xl">
                                <div className="max-w-7xl w-full grid grid-cols-12 gap-16">
                                    <div className="col-span-7 flex flex-col justify-center">
                                        <button onClick={()=>setSelected(null)} className="text-[10px] font-bold tracking-[0.5em] uppercase text-blue-500 mb-12 hover:opacity-50 transition-all">← Cerrar Análisis</button>
                                        <h2 className="text-7xl font-black italic uppercase mb-8 leading-[0.9] tracking-tighter text-blue-50">{selected.tematica}</h2>
                                        <p className="text-2xl text-gray-500 font-light leading-relaxed italic pr-10">"{selected.descripcion}"</p>
                                    </div>
                                    <div className="col-span-5 space-y-6 max-h-[70vh] overflow-y-auto pr-6 hide-scroll border-l border-white/5 pl-12">
                                        <h4 className="text-[10px] tracking-[0.4em] uppercase text-blue-500 font-black mb-10 italic">Divergencia Regional</h4>
                                        {Object.entries(selected.perspectivas).map(([reg, txt]) => (
                                            <div key={reg} className="p-6 glass border-l-4 rounded-r-3xl" style={{borderColor: REGIONS[reg]?.color}}>
                                                <span className="text-[10px] font-black uppercase block mb-2 tracking-widest" style={{color: REGIONS[reg]?.color}}>{REGIONS[reg]?.name}</span>
                                                <p className="text-sm text-gray-300 italic leading-relaxed">"{txt}"</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
