<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROXIMITY | Intelligence Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <style>
        body { background: #020617; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .glass-heavy { background: rgba(5, 10, 20, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .modal { opacity: 0; visibility: hidden; transition: 0.4s; position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; }
        .modal.open { opacity: 1; visibility: visible; }
        .swiper-slide { width: 300px; height: 350px; border-radius: 20px; padding: 20px; background: #0f172a; border: 1px solid rgba(255,255,255,0.05); transform: scale(0.9); transition: 0.4s; }
        .swiper-slide-active { transform: scale(1.1); border-color: var(--glow); box-shadow: 0 0 30px var(--glow-alpha); }
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; }
    </style>
</head>
<body class="p-6 md:p-12">

    <header class="flex justify-between items-end border-b border-white/10 pb-8 mb-10">
        <div>
            <h1 class="text-6xl font-black tracking-tighter italic uppercase text-white">Proximity</h1>
            <p class="text-blue-500 font-mono text-xs tracking-widest uppercase">Deep Intelligence v26.0</p>
        </div>
        <button onclick="openGuide()" class="bg-blue-600/10 border border-blue-500/30 px-6 py-2 rounded-full text-blue-400 text-xs font-bold hover:bg-blue-600/20 transition-all">
            METODOLOGÍA ?
        </button>
    </header>

    <div class="swiper mySwiper mb-20">
        <div class="swiper-wrapper" id="swiper-wrapper"></div>
    </div>

    <div id="guide-modal" class="modal">
        <div class="modal-content glass-heavy rounded-[2.5rem] p-10 max-w-4xl relative">
            <button onclick="closeGuide()" class="absolute top-8 right-10 text-4xl">&times;</button>
            <h1 class="text-4xl font-black italic uppercase mb-8">Manual de Operaciones</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                <div class="p-6 bg-white/5 rounded-2xl border border-white/10">
                    <h3 class="text-blue-400 font-bold mb-2 uppercase">Centroide (Consenso)</h3>
                    <p class="text-slate-400">Es el promedio matemático de la narrativa global. El punto donde coinciden la mayoría de las fuentes.</p>
                </div>
                <div class="p-6 bg-white/5 rounded-2xl border border-white/10">
                    <h3 class="text-red-400 font-bold mb-2 uppercase">Divergencia</h3>
                    <p class="text-slate-400">Noticias alejadas del centro. Revelan datos que otros omiten o enfoques regionales únicos analizados por IA.</p>
                </div>
            </div>
            <button onclick="closeGuide()" class="w-full mt-8 py-4 bg-white text-black font-black uppercase rounded-xl">Entendido</button>
        </div>
    </div>

    <div id="area-modal" class="modal">
        <div class="modal-content glass-heavy rounded-[2rem] p-8 w-[95%] max-w-7xl h-[85vh] flex flex-col">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h3 id="modal-area-title" class="text-4xl font-black uppercase italic"></h3>
                    <p id="modal-consensus" class="text-slate-400 text-sm italic mt-1"></p>
                </div>
                <button onclick="closeAreaModal()" class="text-4xl">&times;</button>
            </div>
            <div class="flex-grow grid grid-cols-1 lg:grid-cols-3 gap-8 overflow-hidden">
                <div class="lg:col-span-2 bg-black/30 rounded-3xl relative p-4">
                    <canvas id="areaScatterChart"></canvas>
                </div>
                <div id="particles-list" class="overflow-y-auto custom-scroll space-y-3 pr-2"></div>
            </div>
        </div>
    </div>

    <script>
        const COLORS = { "USA": "#3b82f6", "RUSSIA": "#ef4444", "CHINA": "#f97316", "EUROPE": "#fde047", "LATAM": "#d946ef", "MID_EAST": "#10b981", "INDIA": "#8b5cf6", "AFRICA": "#22c55e" };
        let fullData = null, scatterChart = null;

        async function init() {
            const res = await fetch('./gravity_carousel.json');
            fullData = await res.json();
            renderSwiper();
        }

        function renderSwiper() {
            document.getElementById('swiper-wrapper').innerHTML = fullData.carousel.map((area, idx) => `
                <div class="swiper-slide" onclick="openAreaModal(${idx})" style="--glow: ${area.color}; --glow-alpha: ${area.color}30">
                    <div class="text-[10px] font-bold text-white mb-2">${area.particulas.length} SEÑALES</div>
                    <h3 class="text-2xl font-black uppercase italic text-white mb-4" style="color:${area.color}">${area.area}</h3>
                    <p class="text-slate-400 text-xs line-clamp-4 leading-relaxed">${area.punto_cero}</p>
                </div>
            `).join('');
            new Swiper(".mySwiper", { effect: "coverflow", centeredSlides: true, slidesPerView: "auto", coverflowEffect: { rotate: 20, stretch: 0, depth: 100, modifier: 1, slideShadows: false } });
        }

        function openAreaModal(idx) {
            const area = fullData.carousel[idx];
            document.getElementById('modal-area-title').innerText = area.area;
            document.getElementById('modal-area-title').style.color = area.color;
            document.getElementById('modal-consensus').innerText = "Consenso: " + area.punto_cero;
            document.getElementById('area-modal').classList.add('open');
            renderParticles(area.particulas);
            setTimeout(() => renderRadar(area.particulas), 300);
        }

        function renderParticles(parts) {
            document.getElementById('particles-list').innerHTML = parts.map(p => `
                <div class="p-4 bg-white/5 rounded-2xl border-l-4 transition-all hover:bg-white/10" style="border-color:${COLORS[p.bloque]}">
                    <div class="flex justify-between text-[10px] font-bold mb-1">
                        <span style="color:${COLORS[p.bloque]}">${p.bloque}</span>
                        <span class="text-slate-500">PROX: ${p.proximidad}%</span>
                    </div>
                    <a href="${p.link}" target="_blank" class="text-sm font-bold text-white hover:text-blue-400">${p.titulo}</a>
                    <div class="text-[10px] mt-2 text-slate-400 italic bg-black/20 p-2 rounded-lg border border-white/5">${p.sesgo}</div>
                </div>
            `).join('');
        }

        function renderRadar(parts) {
            const ctx = document.getElementById('areaScatterChart').getContext('2d');
            if(scatterChart) scatterChart.destroy();
            const ANGLES = { "USA": 0, "RUSSIA": 0.5, "CHINA": 1, "EUROPE": 1.5, "LATAM": 2, "MID_EAST": 2.5, "INDIA": 3, "AFRICA": 3.5 };
            
            scatterChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        data: parts.map(p => {
                            const r = 100 - p.proximidad, a = (ANGLES[p.bloque] || 0) * Math.PI;
                            return { x: r * Math.cos(a), y: r * Math.sin(a), b: p.bloque };
                        }),
                        pointBackgroundColor: c => COLORS[c.raw.b] || '#fff', pointRadius: 9, pointHoverRadius: 12
                    }]
                },
                options: {
                    scales: { x: { display: false, min: -110, max: 110 }, y: { display: false, min: -110, max: 110 } },
                    plugins: { legend: false }
                }
            });
        }

        function openGuide() { document.getElementById('guide-modal').classList.add('open'); }
        function closeGuide() { document.getElementById('guide-modal').classList.remove('open'); }
        function closeAreaModal() { document.getElementById('area-modal').classList.remove('open'); }
        window.onload = init;
    </script>
</body>
</html>
