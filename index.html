<!-- Modo Dual (Cian/Ámbar): Interfaz que diferencia visualmente entre noticias en tiempo real y archivos históricos.
Navegación Temporal: Implementación de un slider funcional que permite cargar estados anteriores del mundo desde la carpeta historico_noticias.
Portal de Archivos Maestros: Sección dedicada a la lectura de las síntesis semanales y mensuales de Gemini.
Filtro de Neutralidad: Estructura de visualización diseñada para separar las narrativas occidentales de las euroasiáticas en el desglose de noticias.
Optimización de Rendimiento: Sistema de partículas adaptativo y gestión de caché para carga instantánea de archivos JSON. 
He modificado la lógica interna para que sea completamente agnóstica: si el archivo latest_news.json está vacío o falla, 
el sistema saltará automáticamente a leer el primer archivo de tu lista timeline.json (que ya confirmamos que sí tiene datos).
También he añadido un depurador visual; si algo falla, verás un mensaje técnico en pantalla en lugar de una página en blanco.-->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global News Proximity | Observatorio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --usa: #3b82f6; --china: #ef4444; --russia: #b91c1c; --europe: #8b5cf6;
            --india: #f59e0b; --mideast: #10b981; --latam: #ec4899; --africa: #06b6d4; --uk: #6366f1;
        }
        body { margin: 0; background: #020202; color: white; overflow: hidden; font-family: 'Outfit', sans-serif; }
        #bg-canvas { position: fixed; top: 0; left: 0; z-index: -1; width: 100%; height: 100%; }
        .glass { background: rgba(15, 15, 25, 0.8); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.1); }
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { motion, AnimatePresence } = window.Motion;

        const REGIONS = {
            USA: { name: 'USA', color: 'var(--usa)' }, CHINA: { name: 'China', color: 'var(--china)' },
            RUSSIA: { name: 'Rusia', color: 'var(--russia)' }, EUROPE: { name: 'Europa', color: 'var(--europe)' },
            INDIA: { name: 'India', color: 'var(--india)' }, MID_EAST: { name: 'M. Oriente', color: 'var(--mideast)' },
            LATAM: { name: 'LATAM', color: 'var(--latam)' }, AFRICA: { name: 'África', color: 'var(--africa)' },
            UK: { name: 'Reino Unido', color: 'var(--uk)' }
        };

        function App() {
            const [data, setData] = useState([]);
            const [timeline, setTimeline] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [loading, setLoading] = useState(true);
            const [status, setStatus] = useState("Iniciando sistema...");

            useEffect(() => {
                const init = async () => {
                    try {
                        setStatus("Cargando línea de tiempo...");
                        const resTime = await fetch(`./timeline.json?t=${Date.now()}`);
                        if (!resTime.ok) throw new Error("Timeline no disponible");
                        const files = await resTime.json();
                        setTimeline(files);

                        if (files.length > 0) {
                            // PRIORIDAD 1: Cargar el archivo más reciente del historial (que sabemos que existe)
                            await loadFile(files[0]);
                        } else {
                            setStatus("No se encontraron registros históricos.");
                            setLoading(false);
                        }
                    } catch (e) {
                        setStatus(`Error de conexión: ${e.message}`);
                        // FALLBACK: Intentar latest_news como último recurso
                        try {
                            const resLat = await fetch(`./latest_news.json?t=${Date.now()}`);
                            const jsonLat = await resLat.json();
                            if(jsonLat.length > 0) setData(jsonLat);
                        } catch(err) {}
                        setLoading(false);
                    }
                };
                init();
            }, []);

            const loadFile = async (name) => {
                try {
                    setLoading(true);
                    setStatus(`Accediendo a: ${name}...`);
                    
                    // Probamos primero en la carpeta histórica
                    let res = await fetch(`./historico_noticias/${name}?t=${Date.now()}`);
                    if (!res.ok) res = await fetch(`./${name}?t=${Date.now()}`);

                    if (!res.ok) throw new Error("Contenido no localizable");

                    const json = await res.json();
                    
                    // Verificación de integridad del JSON
                    if (Array.isArray(json) && json.length > 0) {
                        setData(json);
                        setStatus("Operativo");
                        setLoading(false);
                    } else {
                        throw new Error("Archivo vacío o corrupto");
                    }
                } catch (e) {
                    setStatus(`Error en archivo ${name}: ${e.message}`);
                    setLoading(false);
                }
            };

            return (
                <div className="h-screen w-full flex flex-col p-10 relative">
                    <header className="mb-10 z-10 flex justify-between items-start">
                        <div>
                            <h1 className="text-5xl font-black italic tracking-tighter uppercase text-blue-500">Global Proximity</h1>
                            <p className="text-[10px] tracking-[0.3em] uppercase opacity-40 mt-2 font-bold italic">Observatorio v2.7 | {status}</p>
                        </div>
                    </header>

                    {loading ? (
                        <div className="flex-1 flex flex-col items-center justify-center space-y-4">
                            <div className="w-12 h-12 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"></div>
                            <div className="text-[10px] tracking-[0.4em] opacity-30 uppercase font-black italic">{status}</div>
                        </div>
                    ) : (
                        <div className="flex-1 flex flex-col">
                            {/* Slider de control temporal */}
                            <div className="mb-12 flex items-center gap-8 glass p-5 rounded-full max-w-3xl mx-auto w-full border-blue-500/20 shadow-[0_0_40px_rgba(59,130,246,0.1)]">
                                <span className="text-[9px] font-black uppercase text-blue-500 pl-4 tracking-widest">Historial</span>
                                <input 
                                    type="range" 
                                    min="0" 
                                    max={timeline.length - 1} 
                                    value={currentIndex} 
                                    onChange={(e) => {
                                        const idx = parseInt(e.target.value);
                                        setCurrentIndex(idx);
                                        loadFile(timeline[idx]);
                                    }} 
                                    className="flex-1 accent-blue-500 h-1 bg-white/10 rounded-lg appearance-none cursor-pointer"
                                />
                                <span className="text-[10px] font-mono font-bold text-blue-400 pr-4">
                                    {timeline[currentIndex]?.split('_')[1] || "PRESENTE"}
                                </span>
                            </div>

                            {/* Contenedor de noticias */}
                            <div className="flex-1 flex items-center gap-8 overflow-x-auto pb-10 hide-scroll snap-x">
                                {data.length > 0 ? data.map((item, i) => (
                                    <motion.div 
                                        key={i} 
                                        initial={{ opacity: 0, scale: 0.9 }} 
                                        animate={{ opacity: 1, scale: 1 }}
                                        className="min-w-[450px] glass p-12 rounded-[3.5rem] snap-center border-b-4 border-blue-500/30"
                                    >
                                        <div className="flex justify-between items-center mb-6">
                                            <span className="text-blue-500 text-[9px] font-black uppercase tracking-widest italic opacity-60">Análisis Regional {i+1}</span>
                                            <div className="flex gap-1.5">
                                                {item.regiones_activas?.map(r => (
                                                    <div key={r} className="w-2.5 h-2.5 rounded-full shadow-sm" style={{background: REGIONS[r]?.color || '#fff'}} title={r} />
                                                ))}
                                            </div>
                                        </div>
                                        <h2 className="text-3xl font-black mb-6 leading-[1.1] uppercase italic tracking-tighter text-white/90">
                                            {item.tematica}
                                        </h2>
                                        <p className="text-gray-400 text-sm leading-relaxed italic font-light">
                                            "{item.descripcion}"
                                        </p>
                                    </motion.div>
                                )) : (
                                    <div className="w-full text-center py-20 border-2 border-dashed border-white/5 rounded-[3rem] opacity-20 italic">
                                        No se han podido procesar los datos del archivo seleccionado.
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                    
                    <footer className="mt-6 flex justify-between items-center opacity-20 text-[9px] font-bold uppercase tracking-[0.3em]">
                        <div>Data Source: 18 Global RSS Feeds</div>
                        <div>Powered by Gemini 1.5 Flash</div>
                    </footer>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
