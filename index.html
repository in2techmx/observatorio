<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROXIMITY | Neural Tactical Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050507; --cyan: #00fffb; --panel: #0a0a0f; --border: #1a1a2e; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'Rajdhani', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; }
        header { width: 100%; padding: 20px; text-align: center; border-bottom: 1px solid var(--border); }
        .glitch-title { font-family: 'Share Tech Mono'; font-size: 2.5rem; letter-spacing: 5px; color: #fff; text-shadow: 2px 0 #ff004c, -2px 0 var(--cyan); }
        
        .controls { margin: 20px; display: flex; gap: 15px; }
        select, button { background: var(--panel); border: 1px solid var(--border); color: #fff; padding: 8px 15px; cursor: pointer; font-family: 'Share Tech Mono'; }
        
        #main-viewport { width: 95%; max-width: 1000px; height: 600px; position: relative; border: 1px solid var(--border); background: radial-gradient(circle, #0f0f1a 0%, #050507 80%); }
        svg { width: 100%; height: 100%; }
        .node { cursor: pointer; transition: 0.3s; }
        .node:hover { r: 8 !important; filter: drop-shadow(0 0 10px var(--cyan)); }
        
        #intel-panel { display: none; padding: 40px; overflow-y: auto; height: 100%; line-height: 1.6; }
        #intel-panel h2 { color: var(--cyan); font-family: 'Share Tech Mono'; }
        
        .tooltip { position: absolute; padding: 10px; background: rgba(0,0,0,0.9); border: 1px solid var(--cyan); display: none; pointer-events: none; z-index: 100; font-size: 0.8rem; }
    </style>
</head>
<body>

<header>
    <h1 class="glitch-title">PROXIMITY HUB</h1>
    <div class="controls">
        <button onclick="loadData('gravity_carousel.json', 'live')">DIARIO LIVE</button>
        <select id="week-select" onchange="loadData(this.value, 'semanal')">
            <option value="">SEMANAL...</option>
            <option value="mes_s01.json">Semana 1</option>
            <option value="mes_s02.json">Semana 2</option>
        </select>
    </div>
</header>

<div id="main-viewport">
    <div id="tooltip" class="tooltip"></div>
    <div id="intel-panel"></div>
    <svg id="radarSVG" viewBox="0 0 1000 600">
        <circle cx="500" cy="300" r="100" stroke="rgba(255,255,255,0.05)" fill="none" />
        <circle cx="500" cy="300" r="200" stroke="rgba(255,255,255,0.05)" fill="none" />
        <g id="node-layer"></g>
    </svg>
</div>

<script>
    async function loadData(file, type) {
        const path = type === 'live' ? file : `historico_noticias/semanal/${file}`;
        try {
            const res = await fetch(path);
            const data = await res.json();
            render(data);
        } catch (e) { alert("Archivo no disponible aún."); }
    }

    function render(data) {
        const radar = document.getElementById('radarSVG');
        const intel = document.getElementById('intel-panel');
        const layer = document.getElementById('node-layer');
        layer.innerHTML = '';

        if (data.sintesis_estrategica) {
            radar.style.display = 'none';
            intel.style.display = 'block';
            intel.innerHTML = `<h2>INFORME ESTRATÉGICO</h2><div>${data.sintesis_estrategica.replace(/\n/g, '<br>')}</div>`;
        } else {
            radar.style.display = 'block';
            intel.style.display = 'none';
            data.carousel.forEach(area => {
                area.particulas.forEach(p => {
                    const r = 300 - (p.proximidad * 2.5);
                    const ang = Math.random() * Math.PI * 2;
                    const x = 500 + r * Math.cos(ang);
                    const y = 300 + r * Math.sin(ang);
                    
                    const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    c.setAttribute("cx", x); c.setAttribute("cy", y); c.setAttribute("r", 4);
                    c.setAttribute("fill", "#00fffb"); c.setAttribute("class", "node");
                    
                    c.onmouseover = (e) => {
                        const tt = document.getElementById('tooltip');
                        tt.style.display = 'block'; tt.style.left = e.pageX + 'px'; tt.style.top = e.pageY + 'px';
                        tt.innerHTML = `<strong>${p.bloque}</strong><br>${p.titulo}<br>Proximidad: ${p.proximidad}%`;
                    };
                    c.onmouseout = () => document.getElementById('tooltip').style.display = 'none';
                    c.onclick = () => window.open(p.link, '_blank');
                    layer.appendChild(c);
                });
            });
        }
    }
    window.onload = () => loadData('gravity_carousel.json', 'live');
</script>
</body>
</html>
