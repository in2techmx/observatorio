<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global News Proximity | Observatorio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --usa: #3b82f6; --china: #ef4444; --russia: #b91c1c; --europe: #8b5cf6;
            --india: #f59e0b; --mideast: #10b981; --latam: #ec4899; --africa: #06b6d4; --uk: #6366f1;
        }
        body { margin: 0; background: #020202; color: white; overflow: hidden; font-family: 'Outfit', sans-serif; }
        #bg-canvas { position: fixed; top: 0; left: 0; z-index: -1; width: 100%; height: 100%; opacity: 0.6; }
        .glass { background: rgba(15, 15, 25, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { motion, AnimatePresence } = window.Motion;

        const REGIONS = {
            USA: { name: 'USA', color: 'var(--usa)' }, CHINA: { name: 'China', color: 'var(--china)' },
            RUSSIA: { name: 'Rusia', color: 'var(--russia)' }, EUROPE: { name: 'Europa', color: 'var(--europe)' },
            INDIA: { name: 'India', color: 'var(--india)' }, MID_EAST: { name: 'M. Oriente', color: 'var(--mideast)' },
            LATAM: { name: 'LATAM', color: 'var(--latam)' }, AFRICA: { name: 'África', color: 'var(--africa)' },
            UK: { name: 'Reino Unido', color: 'var(--uk)' }
        };

        function App() {
            const [data, setData] = useState([]);
            const [selected, setSelected] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                // Animación de partículas sutil
                const canvas = document.getElementById('bg-canvas');
                const ctx = canvas.getContext('2d');
                let pts = [];
                const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                resize(); window.onresize = resize;
                for(let i=0; i<80; i++) pts.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, s:Math.random()*2, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3});
                const draw = () => {
                    ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle="rgba(255,255,255,0.2)";
                    pts.forEach(p => { p.x+=p.vx; p.y+=p.vy; if(p.x<0)p.x=canvas.width; if(p.y<0)p.y=canvas.height; ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2); ctx.fill(); });
                    requestAnimationFrame(draw);
                };
                draw();

                // Carga de datos reales
                fetch(`./latest_news.json?t=${Date.now()}`)
                    .then(r => r.json()).then(d => { setData(d); setLoading(false); })
                    .catch(e => console.error("Error", e));
            }, []);

            if(loading) return <div className="h-screen flex items-center justify-center tracking-[0.5em] text-xs opacity-50">SINCRONIZANDO PROXIMIDAD...</div>;

            return (
                <div className="h-screen w-full flex flex-col p-10 overflow-hidden relative">
                    <header className="mb-12 flex justify-between items-end">
                        <div>
                            <h1 className="text-5xl font-black italic tracking-tighter">GLOBAL NEWS <span className="text-blue-500 not-italic">PROXIMITY</span></h1>
                            <p className="text-[10px] tracking-[0.3em] uppercase opacity-40 mt-2">Divergencia Narrativa detectada por IA</p>
                        </div>
                    </header>

                    <AnimatePresence mode="wait">
                        {!selected ? (
                            <motion.div key="list" initial={{opacity:0, y:20}} animate={{opacity:1, y:0}} exit={{opacity:0, y:-20}} className="flex-1 flex flex-col justify-center">
                                <div className="flex gap-8 overflow-x-auto pb-10 hide-scroll snap-x">
                                    {data.map((item, i) => (
                                        <motion.div key={i} whileHover={{y:-10}} onClick={() => setSelected(item)} className="min-w-[400px] glass p-10 rounded-[2rem] cursor-pointer snap-center border-b-4 border-blue-500/30">
                                            <span className="text-[10px] font-bold text-blue-400 mb-4 block tracking-widest uppercase">Eje de Análisis 0{i+1}</span>
                                            <h2 className="text-3xl font-bold mb-4 leading-tight">{item.tematica}</h2>
                                            <p className="text-gray-400 text-sm line-clamp-2">{item.descripcion}</p>
                                            <div className="mt-8 flex gap-2">
                                                {item.regiones_activas.map(r => <div key={r} className="w-3 h-3 rounded-full" style={{background: REGIONS[r]?.color}} />)}
                                            </div>
                                        </motion.div>
                                    ))}
                                </div>
                            </motion.div>
                        ) : (
                            <motion.div key="detail" initial={{opacity:0, scale:0.9}} animate={{opacity:1, scale:1}} exit={{opacity:0}} className="flex-1 grid grid-cols-12 gap-10 min-h-0">
                                <div className="col-span-8 glass rounded-[3rem] relative flex items-center justify-center overflow-hidden">
                                    <button onClick={()=>setSelected(null)} className="absolute top-8 left-8 text-[10px] tracking-widest uppercase opacity-50 hover:opacity-100">← Volver</button>
                                    <div className="text-center z-10 max-w-lg p-6">
                                        <h2 className="text-5xl font-black uppercase italic mb-6">{selected.tematica}</h2>
                                        <p className="text-gray-400">{selected.descripcion}</p>
                                    </div>
                                    {Object.keys(REGIONS).map((r, i) => {
                                        const active = selected.regiones_activas.includes(r);
                                        const ang = (i/Object.keys(REGIONS).length) * Math.PI * 2;
                                        return (
                                            <motion.div key={r} animate={{x: Math.cos(ang)*320, y: Math.sin(ang)*180}} className={`absolute p-4 glass rounded-2xl w-32 text-center border-t-4 ${!active && 'opacity-10 grayscale'}`} style={{borderColor: REGIONS[r].color}}>
                                                <span className="text-[10px] font-bold block" style={{color: REGIONS[r].color}}>{REGIONS[r].name}</span>
                                            </motion.div>
                                        )
                                    })}
                                </div>
                                <div className="col-span-4 overflow-y-auto hide-scroll space-y-4">
                                    <h3 className="text-[10px] tracking-widest uppercase opacity-50 mb-6 text-blue-400">Perspectivas Regionales</h3>
                                    {Object.entries(selected.perspectivas).map(([reg, text]) => (
                                        <div key={reg} className="p-5 glass border-l-4 rounded-r-xl" style={{borderColor: REGIONS[reg]?.color}}>
                                            <span className="text-[10px] font-bold uppercase block mb-1" style={{color: REGIONS[reg]?.color}}>{REGIONS[reg]?.name}</span>
                                            <p className="text-xs text-gray-300 italic leading-relaxed">"{text}"</p>
                                        </div>
                                    ))}
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
